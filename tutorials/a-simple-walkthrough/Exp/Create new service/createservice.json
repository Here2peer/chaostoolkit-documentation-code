{
	"version": "0.0.1",
	"title": "Testing a service yaml to see if connections are available.",
	"description": "Should create a new service with the provided service config and test whether  the service is available.",
	"tags": ["kubernetes"],

	"secrets": {
		"k8s": {
			"kubernetes": {
				"KUBERNETES_HOST": "192.168.1.3:80",
				"KUBERNETES_CERT_FILE": {
					"type": "env",
					"key": "kubecert"
				},
				"KUBERNETES_KEY_FILE": {
					"type": "env",
					"key": "kubekey"
				}
			}
		}
	},
	"steady-state-hypothesis": {
		"title": "Verifying deployment of DB is available and healthy",
		"probes": [{
			"name": "Deployment-available-and-healthy",
			"type": "probe",
			"tolerance": true,
			"secrets": ["k8s"],
			"provider": {
				"type": "python",
				"module": "chaosk8s.probes",
				"func": "deployment_available_and_healthy",
				"arguments": {
					"name": "postgres"
				}
			}
		}]
	},
	"method": [{
			"name": "create-service-endpoint",
			"type": "action",
			"provider": {
				"type": "python",
				"module": "chaosk8s.service.actions",
				"func": "create_service_endpoint",
				"arguments": {
					"spec_path": "/db-service.yaml"
				}
			}
		},
		{
			"name": "service-is-initialized",
			"type": "probe",
			"provider": {
				"type": "python",
				"module": "chaosk8s.service.probes",
				"func": "service_is_initialized",
				"arguments": {
					"label_selector": "app=test"
				}
			}
		}
	],
	"rollbacks": [

		{
			"name": "delete-service",
			"type": "action",
			"provider": {
				"type": "python",
				"module": "chaosk8s.service.actions",
				"func": "delete_service",
				"arguments": {
					"name": "postgrestest"
				}
			}
		}
	]

}